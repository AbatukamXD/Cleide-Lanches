import os
import time
import random
import webbrowser
import signal

def salvar_variaveis(path_file, **kwargs):
    with open(path_file, 'w') as f:
        for nome, valor in kwargs.items():
            f.write(f"{nome}: {valor}\n")

def carregar_variaveis(path_file):
    variaveis = {}
    try:
        with open(path_file, 'r') as f:
            for line in f:
                chave, valor = line.strip().split(': ')
                variaveis[chave] = valor
    except FileNotFoundError:
        return None
    return variaveis

def verifica_primeira_vez():
    if os.path.exists("dados_pessoais.txt"):
        variaveis_carregadas = carregar_variaveis('dados_pessoais.txt')
        if variaveis_carregadas:
            nome = variaveis_carregadas.get('nome', 'desconhecido')
            print(f"Vejo que voc√™ j√° tem registro, por acaso voc√™ √©: {nome}?")
            resposta = input("Digite: \n1 - Sim\n2 - N√£o\n-------> ")
            if resposta == "2":
                cadastrar_usuario()
        else:
            cadastrar_usuario()
    else:
        cadastrar_usuario()

def cadastrar_usuario():
    print("\nDigite as informa√ß√µes a seguir para se cadastrar!ü•≥")
    nome_v = input("Digite seu Nome: ")
    email_v = input("Digite seu Email: ")
    senha_v = input("Digite sua Senha: ")
    print("Cadastro Conclu√≠do.")
    salvar_variaveis('dados_pessoais.txt', nome=nome_v, senha=senha_v, email=email_v)

def calcular_total(carrinho):
    return sum(item["valor"] for item in carrinho)

def perguntar_se_deseja_continuar():
    while True:
        opcao = input("Deseja pedir mais alguma coisa? [SIM] ou [N√ÉO]: ").strip().upper()
        match opcao:
            case "SIM":
                return True
            case "N√ÉO":
                return False
            case _:
                print("Op√ß√£o inv√°lida. Tente novamente.")


def confirmar_pedido(lista_carrinho):
    if lista_carrinho:
        print("Voc√™ escolheu:")
        for item in lista_carrinho:
            print(f"- {item['nome']} (R$ {item['valor']:.2f})")
        total = calcular_total(lista_carrinho)
        print(f"Total do pedido: R$ {total:.2f}")
    else:
        print("Voc√™ n√£o fez nenhum pedido.")
        return False

    confirmar = input("Deseja confirmar o pedido? [SIM] ou [N√ÉO]: ").strip().upper()
    match confirmar:
        case "SIM":
            return True
        case "N√ÉO":
            return False
        case _:
            print("Op√ß√£o inv√°lida.")
            return False


def cardapio():
    lista_carrinho = []
    while True:
        print("Este √© o nosso card√°pio! Aproveite! üòú")
        print("-" * 20)
        print("[1] Salgados ü•ê\n[2] Hamburger üçî\n[3] Bebidas ü•§\n[4] Fechar üëã")
        entrada = input("Selecione uma das nossas op√ß√µes: ")

        match entrada:
            case "1":
                lista_carrinho += salgados()
            case "2":
                lista_carrinho += burger()
            case "3":
                lista_carrinho += bebidas()
            case "4":
                print("\nAgradecemos a sua visita! \nEsperamos por voc√™ na pr√≥xima üòÅ")
                pid = os.getpid()
                os.kill(pid, signal.SIGTERM)
            case _:
                print("A Cleide Lanches n√£o entendeu. Tente novamente!")

        if confirmar_pedido(lista_carrinho):
            total = calcular_total(lista_carrinho)
            print(f"Seu pedido foi confirmado e o valor total ficou de: R$ {total:.2f}")
            break  # Sai do loop do card√°pio


def salgados():
    lista = []
    print("\n√ìtima escolha!")
    print("[1] Pastel\n[2] Ris√≥lis\n[3] Enroladinho")
    entrada = input("Selecione uma das nossas op√ß√µes: ")
    if entrada == "1":
        lista.append(pastel())
    elif entrada == "2":
        lista.append(risolis())
    elif entrada == "3":
        lista.append({"nome": "Enroladinho", "valor": 2.00})
        print("Voc√™ escolheu Enroladinho.")
    else:
        print("Op√ß√£o inv√°lida.")

    if not perguntar_se_deseja_continuar():
        return lista
    return []

def pastel():
    entrada = input("Op√ß√µes de Pastel: \n[1] Carne ü•©\n[2] Frango üçó\n[3] Queijo üßÄ\nEscolha: ")
    if entrada == "1":
        return {"nome": "Pastel de Carne", "valor": 5.00}
    elif entrada == "2":
        return {"nome": "Pastel de Frango", "valor": 5.00}
    elif entrada == "3":
        return {"nome": "Pastel de Queijo", "valor": 5.00}
    else:
        print("Op√ß√£o inv√°lida.")
        return {}

def risolis():
    entrada = input("Op√ß√µes de Ris√≥lis: \n[1] Carne ü•©\n[2] Frango üçó\nEscolha: ")
    if entrada == "1":
        return {"nome": "Ris√≥lis de Carne", "valor": 4.00}
    elif entrada == "2":
        return {"nome": "Ris√≥lis de Frango", "valor": 4.00}
    else:
        print("Op√ß√£o inv√°lida.")
        return {}

def burger():
    entrada = input("Op√ß√µes de Hamburger: \n[1] Super Cleide üò±\n[2] Big Cleide üòé\n[3] Veg Cleide ü•ó\nEscolha: ")

    match entrada:
        case "1":
            return [{"nome": "Super Cleide", "valor": 23.00}]
        case "2":
            return [{"nome": "Big Cleide", "valor": 18.00}]
        case "3":
            return [{"nome": "Veg Cleide", "valor": 20.00}]
        case _:
            print("Op√ß√£o inv√°lida.")
            return []


def bebidas():
    print("\nOp√ß√µes de Bebidas: ")
    print("[1] Pepsi \n[2] Fanta\n[3] Guaran√°\n[4] Sprite\n[5] Tap Water")
    entrada = input("Escolha uma bebida: ")

    if entrada in ['1', '2', '3', '4']:
        return [{"nome": "Refrigerante ü•É", "valor": 5.00}]
    elif entrada == "5":
        return [{"nome": "Tap Water üßä", "valor": 3.00}]
    else:
        print("Op√ß√£o inv√°lida.")
        return []

def main():
    verifica_primeira_vez()
    cardapio()

    metodo_de_pagamento = int(input("\nQual m√©todo de pagamento voc√™ deseja?\n1 - Pix\n2 - Dinheiro\n3 - Cart√£o\n------> "))
    if metodo_de_pagamento == 1:
        print("‚¨õ‚¨ú‚¨õ‚¨õ‚¨ú\n‚¨ú‚¨ú‚¨õ‚¨ú‚¨õ\n‚¨õ‚¨ú‚¨õ‚¨ú‚¨õ\n‚¨ú‚¨õ‚¨ú‚¨õ‚¨õ")
    elif metodo_de_pagamento == 2:
        print("V√° ao caixa e realize o pagamento!")
    elif metodo_de_pagamento == 3:
        cartao_v = input("Digite os n√∫meros do seu cart√£o: ")
        salvar_variaveis('dados_pessoais.txt', cartao=cartao_v)

    print(f"\nPedido Realizado com sucesso, o n√∫mero do seu pedido √©: {random.randint(0, 999)}")
    print("O tempo de espera √© de: ")
    segundos = 59
    minutos = random.randint(2, 6)

    while minutos >= 0:
        if segundos > -1:
            print(f"{minutos}:{segundos:02d}", end="\r")
            time.sleep(0.01)
            segundos -= 1
            if segundos == -1:
                segundos = 59
                minutos -= 1

    print("\nA comida est√° pronta!")
    webbrowser.open("https://www.youtube.com/shorts/ZjEJaWByFlY")

if __name__ == "__main__":
    main()

